<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="google-site-verification" content="TZE0rZyIqLl10trYu3BWBWa1Vmz6HFwhb2OcNEK4u-s" />
     <link rel="shortcut icon" href= /img/favicon.ico >
    <title>
        Share
    </title>
    <meta name="description" content= 嘿，我是刘训灼～这是我的子站，用于展示写的Hexo主题：Coder。欢迎访问！ >
    <meta name="keywords" content= Blog,Hexo,Theme,万松,Wansong,Aaron >
    
<link rel="stylesheet" href="/libs/highlight/styles/monokai-sublime.css">

    
<link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">

    
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="Share" type="application/atom+xml">
</head>
<body id="bodyx">
    <div class="hd posts">
    <a href="/index.html"><i class="fa fa-home
 replay-btn" aria-hidden="true"></i></a>
    <div class="post-title">
        <p>
            sed,awk
        </p>
        <hr>
    </div>
    <div class="post-content">
        <p>Linux shell编程从初学到精通 </p>
<blockquote>
<p>最近工作时遇到了一个问题，就是查看进行时，只查看某些进行的进程号，若直接用ps aux|grep sms  这样会得到一大堆的东东，所以同事推荐用awk,同<br>时也提及了sed。</p>
</blockquote>
<blockquote>
<p>这里抽时间对这两个命令做一个总结，仅为个人学习工作所用。</p>
</blockquote>
<p>##sed、awk是什么？</p>
<pre><code>它们是linux\unix系统中的两种功能强大的文本处理工具。</code></pre>
<ul>
<li>有一个sed的编辑器，才有了sed（stream editor）这个名字,它是一个将一系列编辑命令作用于一个文本文件的理想工具。</li>
<li>由于创建awk的三个作者名称 是Aho、Weinberger和Kernighan，所以得名为AWK,是一种能够对结构化数据进行操作并产生格式化报表的编程语言。</li>
</ul>
<p>##sed的使用</p>
<p>###使用场合</p>
<ul>
<li>编辑相对交互式广西编辑器而言太大的文件</li>
<li>编辑命令太复杂，在交互式文本编辑器中难以输入的情况</li>
<li>对文件扫描一遍，但是需要执行多个编辑函数的情况</li>
</ul>
<p>sed只对缓冲区中的原始文件的副本进行编辑，并不编辑原始的文件。so，若要保存个性后的文件，压根将输出重定向到另一个文件。如：</p>
<pre><code>sed &#39;sed command&#39; source-file &gt; target-file</code></pre>
<p>###调用方式<br><code>如何没有指定输入文件sed将从标准输入中接受输入</code></p>
<ul>
<li><p>在shell命令行输入命令调用sed，格式为：</p>
<p>  sed [option] ‘sed command’ 输入文件<br><code>注意此处为单引号将命令引起来</code></p>
</li>
<li><p>将sed命令插入脚本文件后，然后通过sed命令调用它，格式为：</p>
<p>  sed [option] -f sed脚本文件 输入文件</p>
</li>
<li><p>将sed命令插入脚本文件后，最常用的方法是设置该脚本文件为可执行，然后直接执行该脚本，格式为：</p>
<p>  ./sed脚本文件 输入文件</p>
</li>
</ul>
<p><code>但此命令脚本文件，应该以sha-bang(#!)开头，sha-bang后面是解析这个脚本的程序名。</code></p>
<p>####sed命令选项及其意义</p>
<ul>
<li>-n:不打印所有行到标准输出</li>
<li>-e:将下一个字符串解析为sed编辑命令，如果只传递一个编辑命令给sed，-e选项可以省略</li>
<li>-f:表示正在调用sed脚本文件</li>
</ul>
<p>###命令组成方式</p>
<pre><code>定位文本行和编辑命令两部分组成</code></pre>
<p>####定位文本</p>
<ul>
<li>使用行号，指定一行，或指定行号范围</li>
<li>使用正则表达式</li>
</ul>
<p><code>下面是sed命令定位文本的方法</code></p>
<ul>
<li>x 为指定的行号</li>
<li>x，y 指定行号范围</li>
<li>/pattern/ 查询包含模式的行</li>
<li>/pattern/pattern/ 查询包含两个模式的行</li>
<li>/pattern/，x 从与模式匹配到x号行之间的行  反之类似</li>
<li>x，y！查询不包括x和y行号的行</li>
</ul>
<p>####常用编辑命令</p>
<ul>
<li>p 打印匹配行</li>
<li>= 打印文件行号</li>
<li>a\ 在定位行号之后追加文本信息</li>
<li>i\ 在定们行号之前插入文本信息</li>
<li>d 删除定位行</li>
<li>c\ 用新文本替换定位文本</li>
<li>s 使用替换模式替换相应模式</li>
<li>r 从另一个文件中读广西</li>
<li>w 将文本写入到一个文件</li>
<li>y 变换字符</li>
<li>q 第一个模式匹配完成后退出</li>
<li>l 显示与八进制ASCII码等价的控制字符</li>
<li>{} 在定位行执行的命令组</li>
<li>n 读取下一个输入行，用下一个命令处理新的行</li>
<li>h 将模式缓冲区的文本复制到保持缓冲区</li>
<li>H 将模式缓冲区的文本追加到保持缓冲区</li>
<li>x 互换模式缓冲区和保持缓冲区的内容</li>
<li>g 将保持缓冲区的内容复制到模式缓冲区</li>
<li>G 将保持缓冲区的内容追加到模式缓冲区</li>
</ul>
<p>###实例<br>我们就用下面这个文件内容作为事例参考：</p>
<pre><code>#!/usr/bin/env python
import os
import sys

if __name__ == &quot;__main__&quot;:
    os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;test.settings&quot;)

    from django.core.management import execute_from_command_line

    execute_from_command_line(sys.argv)</code></pre>
<h4 id="n-选项的使用"><a href="#n-选项的使用" class="headerlink" title="-n 选项的使用"></a>-n 选项的使用</h4><ul>
<li>使用-n 不输出所有的内容  1p 输出第一行</li>
</ul>
<pre><code>➜  linuxstudy  sed -n &#39;1p&#39; manage.py2
#!/usr/bin/env python</code></pre>
<ul>
<li>打印3到6行</li>
</ul>
<pre><code>➜  linuxstudy  sed -n &#39;3,6p&#39; manage.py2
import sys

if __name__ == &quot;__main__&quot;:
    os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;test.settings&quot;)</code></pre>
<ul>
<li>模式匹配</li>
</ul>
<pre><code>➜  linuxstudy  sed -n &#39;/environ/p&#39; manage.py2
    os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;test.settings&quot;)</code></pre>
<h4 id="e-选项的使用"><a href="#e-选项的使用" class="headerlink" title="- e 选项的使用"></a>- e 选项的使用</h4><ul>
<li>打印行号：</li>
</ul>
<pre><code>    ➜  linuxstudy  sed -n &#39;/env/=&#39; manage.py2
    1
    6

添加e选项：

    ➜  linuxstudy  sed -n -e &#39;/env/p&#39; -e &#39;/env/=&#39; manage.py2 
    #!/usr/bin/env python
    1
        os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;test.settings&quot;)
    6

    `sed不支持多个编辑命令的用法，带多个编辑命令的用法，一般格式为：`

    sed [option] -e 编辑命令 -e 编辑命令 ... -e 编辑命令 输入文件

    将下面命令操作存放到一个后缀为.sed的文件中，让其可执行
    #!/usr/bin/sed -f 
    /command/a\
    we append a new line</code></pre>
<h4 id="sed文本定位"><a href="#sed文本定位" class="headerlink" title="sed文本定位"></a>sed文本定位</h4><ul>
<li>匹配元字符 $和.</li>
</ul>
<pre><code>    ➜  linuxstudy  sed -n &#39;/\./p&#39; manage.py2
        os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;test.settings&quot;)
        from django$.core.management import execute_from_command_line
        execute_from_command_line(sys.argv)
    ➜  linuxstudy  sed -n &#39;/\$/p&#39; manage.py2
        from django$.core.management import execute_from_command_line</code></pre>
<ul>
<li>元字符进行匹配</li>
</ul>
<pre><code>    $在正则中表示行尾，但在这里表示最后一行
    sed的基本命令，可以放在单引号外或内都行，根据自己的习惯
    ➜  linuxstudy  sed  &#39;$p&#39; manage.py2 得取最后一行

    ➜  linuxstudy sed  -n &#39;/.*line/p&#39; manage.py2 找出以line结尾的行</code></pre>
<ul>
<li><p>! 符号，表示取反，但是不能用于模式匹配的取反</p>
<pre><code>  ➜  linuxstudy  sed -n &#39;2,4!p&#39; manage.py2 不打印2到4行 </code></pre>
</li>
<li><p>使用行号与关键字匹配限定行范围</p>
<pre><code>  /pattern/,x和x,/pattern/ 这两种形式其实与x,y一样的，只是将x或y代替罢了

  ➜  linuxstudy  sed -n &#39;4,/mana/p&#39; manage.py2  得到的是从第四行起到与mana匹配的行的内容

  if __name__ == &quot;__main__&quot;:
      os.environ.setdefault(&quot;DJANGO_SETTINGS_MODULE&quot;, &quot;hwbuluo.settings&quot;)

      from django$.core.management import execute_from_command_line</code></pre>
</li>
</ul>
<h4 id="sed文本编辑"><a href="#sed文本编辑" class="headerlink" title="sed文本编辑"></a>sed文本编辑</h4><ul>
<li><p>插入文本    i\</p>
<pre><code>  在匹配行的前端插入
  sed &#39;定位i\text&#39; 文件

  修改上面的追加脚本：
  #!/usr/bin/sed -f 
  /command/i\
  we append a new line</code></pre>
</li>
<li><p>修改文本 modify.sed    c\</p>
<pre><code>  -------------------
  #!/usr/bin/sed -f

  /command/c\
  I modify the file.
  -------------------

  执行：./modify.sed</code></pre>
</li>
<li><p>删除文本  d  与追加和插入修改有所不同，这里在后面不需要添加\</p>
<pre><code>  sed &#39;1,3d&#39; manage.py2</code></pre>
</li>
<li><p>替换文本 替换文本与修改文本类似，只是修改是对一整行的个性，替换则是对局部进行修改</p>
<pre><code>  s/被替换的字符串/新字符串/[替换选项]

  替换选项及意义：
      g:替换文本中所有出现被替换字符串之处,若不使用此选项，则只替换每行的第一个匹配上的字符串
      p:与-n选项结合，只打印替换行
      w 文件名:表示将输出定向到一个文件

  ➜  linuxstudy  sed -n &#39;s/command/============/p&#39; manage.py2 
      from django$.core.management import execute_from_============_line
      execute_from_============_line(sys.argv)

  也可以 linuxstudy  sed -n &#39;s/command/============/2p&#39; manage.py2   来替换每行出现的第几个 </code></pre>
</li>
</ul>
<ul>
<li></li>
</ul>
<p>##<a target="_blank" rel="noopener" href="http://www.cnblogs.com/chengmo/archive/2010/10/08/1845913.html">awk的使用</a></p>
<p>###使用场合<br>###调用方式<br>###实例</p>
<pre><code>awk -F &#39;:&#39; &#39;BEGIN &#123;count=0;&#125; &#123;name[count] = $1;count++;&#125;;END &#123;for (i=0;i&lt;NR;i++) print i,name[i]&#125;&#39;   /etc/passwd

0 root
1 daemon
2 bin
3 sys
4 sync
5 games
6 man
7 lp
8 mail

ls -l |awk &#39;BEGIN &#123;size=0;&#125; &#123;size=size+$5;&#125; END&#123;print &quot;[end]size is&quot;,size/1024/1024 ,&quot;M&quot;&#125;&#39;

[end]size is 0.098505 M</code></pre>

    </div>

    
        <hr class="fhr">
        <div id="vcomments"></div>
    
</div>
    <div class="footer" id="footer">
    <p><h4>版权所有 © 2020 | 作者: 万松 | 主题 By <a class="theme-author" target="_blank" rel="noopener" href="https://github.com/Xunzhuo/hexo-theme-coder" style="font-size:14px; color: #969696">Coder</a></h4>
    
        <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
        <span id="busuanzi_container_site_pv">本站浏览总访问量: <span id="busuanzi_value_site_pv"></span></span>
        <span class="post-meta-divider">|</span>
        <span id="busuanzi_container_site_uv">本站访问人数: <span id="busuanzi_value_site_uv"></span></span>
    
    <label class="el-switch el-switch-blue el-switch-sm" style="vertical-align: sub;">
        <input type="checkbox" name="switch" id="update_style">
        <span class="el-switch-style"></span>
    </label>

    <!--         <script type="text/javascript">
    var cnzz_protocol = (("https:" == document.location.protocol) ? "https://" : "http://");
    document.write(unescape("%3Cspan id='cnzz_stat_icon_1278548644'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "v1.cnzz.com/stat.php%3Fid%3D1278548644%26show%3Dpic1' type='text/javascript'%3E%3C/script%3E"));
    </script> -->
</p>
</div>

<input type="hidden" id="web_style" value="light">
<input type="hidden" id="valine_appid" value="b13h0PpoiVVieODkmdrjUw2R-gzGzoHsz">
<input type="hidden" id="valine_appKey" value="NMiO8n8rxtwYIaUdndXwbcKH">

<script src="/libs/jquery.min.js"></script>


<script src="/libs/highlight/highlight.pack.js"></script>

<script src='//cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js'></script>

<script src="/js/js.js"></script>

<style type="text/css">
.v * {
color: #698fca;
}
.v .vlist .vcard .vhead .vsys {
color: #3a3e4a;
}
.v .vlist .vcard .vh .vmeta .vat {
color: #638fd5;
}
.v .vlist .vcard .vhead .vnick {
color: #6ba1ff;
}
.v a {
color: #8696b1;
}
.v .vlist .vcard .vhead .vnick:hover {
color: #669bfc;
}
</style>
    <script type="text/javascript" color="173,174,173" opacity='1' zIndex="-2" count="99" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>
</body>
</html>
